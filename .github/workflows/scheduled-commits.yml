name: Scheduled Workflow

permissions:
  contents: write

on:
  schedule:
    # Weekday
    - cron: "0 2 * * 1-5"
    - cron: "0 3 * * 1-5"    
    - cron: "0 4 * * 1-5"
    - cron: "0 6 * * 1-5"
    - cron: "0 7 * * 1-5"
    - cron: "0 8 * * 1-5"
    - cron: "30 11 * * 1-5"
    - cron: "30 12 * * 1-5"
    - cron: "30 13 * * 1-5"
    
    # Weekend
    - cron: "0 3 * * 6,0"
    - cron: "0 7 * * 6,0"
    - cron: "0 13 * * 6,0"
    
  workflow_dispatch:

jobs:
  natural-commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Determine day type & chance
        id: chance
        run: |
          DAY=$(date +%u)   # 1=Mon ... 7=Sun
          
          if [ "$DAY" -le 5 ]; then
            # Weekday (Mon-Fri)
            CHANCE=40
          else
            # Weekend (Sat-Sun)
            CHANCE=20
          fi
          
          DRAW=$((RANDOM % 100))
          
          if [ $DRAW -lt $CHANCE ]; then
            echo "go=yes" >> $GITHUB_OUTPUT
          else
            echo "go=no" >> $GITHUB_OUTPUT
          fi
          
      - name: Stop if not selected
        if: steps.chance.outputs.go == 'no'
        run: echo "No commit this run (natural inactivity)."
        
      - name: Random Delay (0â€“20 minutes)
        if: steps.chance.outputs.go == 'yes'
        run: |
          DELAY=$((RANDOM % 1200))
          echo "Sleeping for $DELAY seconds..."
          sleep $DELAY
          
      - name: Make small change
        if: steps.chance.outputs.go == 'yes'
        run: |
          mkdir -p natural_activity
          echo "Update at $(date)" >> natural_activity/log.txt
          
      - name: Random commit message
        if: steps.chance.outputs.go == 'yes'
        id: msg
        run: |
          msgs=("Update logs" "Small fix" "Minor tweak" "Refactor small part" "Improve flow" "Adjust timestamp" "Routine maintenance" "Optimize detail")
          message=${msgs[$RANDOM % ${#msgs[@]}]}
          echo "message=$message" >> $GITHUB_OUTPUT
          
      - name: Commit & Push
        if: steps.chance.outputs.go == 'yes'
        run: |
          git config user.name "kaelkier"
          git config user.email "rndiaditya.pratama@gmail.com"
          
          git add .
          git commit -m "${{ steps.msg.outputs.message }} ($(date))" || true
          git push
